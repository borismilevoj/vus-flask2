<!DOCTYPE html>
<html>
<head>
    <title>Iskanje po vzorcu</title>
    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
            background-color: #f9f9f9;
        }
        h1 {
            color: #333;
        }
        #polja input {
            width: 40px;
            height: 40px;
            font-size: 24px;
            text-align: center;
            margin: 5px;
        }
        button {
            padding: 10px 15px;
            font-size: 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover {
            background-color: #45a049;
        }
        ul {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>Iskanje gesla po znanih črkah</h1>

    <form id="vzorec-form" method="post" action="/isci_po_vzorcu">
        <input type="hidden" name="vzorec" id="vzorec">
        <input type="hidden" name="dolzina" id="dolzina">
        <button type="submit">IŠČI</button>
    </form>

    <label for="dolzina">Dolžina gesla:</label>
    <select id="dolzina">
        {% for i in range(2, 21) %}
            <option value="{{ i }}">{{ i }}</option>
        {% endfor %}
    </select>

    <div id="polja"></div>

    <button onclick="isci()">IŠČI</button>
    <button onclick="ponastavi()">PONASTAVI</button>

    <div id="rezultati"></div>

    <script>
        const dolzinaSelect = document.getElementById("dolzina");
        const poljaDiv = document.getElementById("polja");

        dolzinaSelect.addEventListener("change", ustvariPolja);

        function ustvariPolja() {
            const dolzina = parseInt(dolzinaSelect.value);
            poljaDiv.innerHTML = "";
            for (let i = 0; i < dolzina; i++) {
                const input = document.createElement("input");
                input.maxLength = 1;
                input.dataset.index = i;
                input.addEventListener("input", premikNaprej);
                poljaDiv.appendChild(input);
            }
        }

        function premikNaprej(e) {
            const naslednji = e.target.nextElementSibling;
            if (naslednji && e.target.value) {
                naslednji.focus();
            }
        }

        function isci() {
            let vzorec = "";
            for (let input of poljaDiv.children) {
                vzorec += input.value ? input.value.toUpperCase() : "_";
            }

            const dolzina = dolzinaSelect.value;

            fetch("/isci_po_vzorcu", {
                method: "POST",
                headers: {
                    "Content-Type": "application/x-www-form-urlencoded"
                },
                body: `vzorec=${vzorec}&dolzina=${dolzina}`
            })
            .then(response => response.json())
            .then(data => {
                const div = document.getElementById("rezultati");
                if (data.length > 0) {
                    div.innerHTML = `<p><strong>Zadetkov: ${data.length}</strong></p><ul>` + data.map(item => `<li><strong>${item.geslo}</strong>: ${item.opis}</li>`).join('') + "</ul>";
                } else {
                    div.innerHTML = `<p><strong>Zadetkov: 0</strong></p><p>Ni zadetkov.</p>`;
                }
            });
        }

        function ponastavi() {
            document.getElementById("rezultati").innerHTML = "";
            ustvariPolja();
        }

        ustvariPolja(); // inicialno
    </script>
</body>
</html>
