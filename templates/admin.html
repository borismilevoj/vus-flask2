{% extends "base.html" %}

{% block title %}Administracija gesel | VUS{% endblock %}

{% block content %}
<div class="container my-4">
    <h2 class="text-center mb-4">Administracija gesel VUS</h2>

    <!-- Preverjanje gesel -->
    <div class="card mb-4">
        <div class="card-body">
            <div class="input-group">
                <input type="text" id="gesloPreveri" class="form-control" placeholder="Vnesi geslo za preverjanje">
                <button class="btn btn-primary" onclick="preveriGeslo()">PREVERI</button>
            </div>
            <div id="rezultatiPreverjanja" class="mt-3"></div>
        </div>
    </div>

    <!-- Dodajanje novih gesel -->
    <div class="card mb-4">
        <div class="card-body">
            <input type="text" id="novoGeslo" class="form-control mb-2" placeholder="Novo geslo">
            <textarea id="opisNovegaGesla" class="form-control mb-2" placeholder="Opis novega gesla" rows="4"></textarea>
            <button class="btn btn-success" onclick="dodajGeslo()">DODAJ</button>
        </div>
    </div>

    <!-- Zamenjava izraza v opisih -->
    <div class="card mb-4">
        <div class="card-body">
            <h5>Zamenjaj izraz v opisih</h5>
            <input type="text" id="original" class="form-control mb-2" placeholder="Izvirni izraz">
            <input type="text" id="zamenjava" class="form-control mb-2" placeholder="Nov izraz">
            <button class="btn btn-warning" onclick="zamenjajIzraz()">ZAMENJAJ</button>
            <div id="rezultatZamenjave" class="mt-2"></div>
        </div>
    </div>
<div class="text-center mb-4">
  <a href="{{ url_for('prispevaj_geslo') }}" class="btn btn-info">Prispevaj geslo</a>
</div>

    <!-- Števec gesel v bazi -->
    <div class="alert alert-info text-center" id="stevec">
        Gesel v bazi: nalaganje...
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
document.addEventListener("DOMContentLoaded", function(){
    fetch('/stevec_gesel')
    .then(response => response.json())
    .then(data => {
        document.getElementById('stevec').textContent = "Gesel v bazi: " + data.steviloGesel;
    })
    .catch(err => console.error("Napaka pri pridobivanju števca:", err));
});

function preveriGeslo() {
    const geslo = document.getElementById('gesloPreveri').value;
    fetch('/preveri', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({geslo: geslo})
    })
    .then(response => response.json())
    .then(data => {
        const rezultat = document.getElementById('rezultatiPreverjanja');
        if(data.obstaja){
            rezultat.innerHTML = `<div class="alert alert-success">Geslo obstaja: <b>${data.geslo}</b> - ${data.opis}</div>`;
        } else {
            rezultat.innerHTML = `<div class="alert alert-danger">Geslo <b>${geslo}</b> ne obstaja v bazi.</div>`;
        }
    });
}

function dodajGeslo() {
    const novoGeslo = document.getElementById('novoGeslo').value;
    const opis = document.getElementById('opisNovegaGesla').value;

    fetch('/dodaj_geslo', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({geslo: novoGeslo, opis: opis})
    })
    .then(response => response.json())
    .then(data => {
        alert(data.sporocilo);
        location.reload();
    });
}

function zamenjajIzraz() {
    const original = document.getElementById('original').value;
    const zamenjava = document.getElementById('zamenjava').value;

    fetch('/zamenjaj', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({original, zamenjava})
    })
    .then(response => response.json())
    .then(data => {
        document.getElementById('rezultatZamenjave').innerHTML =
            `<div class="alert alert-info">Število zamenjanih opisov: ${data.spremembe}</div>`;
    })
    .catch(err => console.error("Napaka pri zamenjavi izraza:", err));
}
</script>
{% endblock %}
